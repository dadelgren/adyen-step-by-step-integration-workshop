{"version":3,"file":"ANCV.js","sources":["../../../../src/components/ANCV/ANCV.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport ANCVInput from './components/ANCVInput';\nimport config from './components/ANCVAwait/config';\nimport { Await } from '../../components/internal/Await';\nimport SRPanelProvider from '../../core/Errors/SRPanelProvider';\nimport AdyenCheckoutError from '../../core/Errors/AdyenCheckoutError';\nimport PayButton from '../internal/PayButton';\nimport { ANCVConfiguration } from './types';\nimport { sanitizeResponse, verifyPaymentDidNotFail } from '../internal/UIElement/utils';\n\nexport class ANCVElement extends UIElement<ANCVConfiguration> {\n    public static type = 'ancv';\n\n    /**\n     * Formats the component data output\n     */\n    formatData() {\n        return {\n            paymentMethod: {\n                type: ANCVElement.type,\n                beneficiaryId: this.state.data?.beneficiaryId\n            }\n        };\n    }\n\n    private onOrderRequest = data => {\n        if (this.props.onOrderRequest)\n            return new Promise((resolve, reject) => {\n                this.props.onOrderRequest(resolve, reject, data);\n            });\n\n        if (this.props.session) {\n            return this.props.session.createOrder();\n        }\n    };\n\n    /**\n     * Check if order exists, if it does Resolve.\n     * Otherwise createOrder and then Resolve.\n     */\n    public createOrder = (): Promise<void> => {\n        this.setStatus('loading');\n\n        // allow for multiple ANCV payments, follow giftcard logic and just use order if it exists\n        if (this.props.order) {\n            return Promise.resolve();\n        }\n\n        return this.onOrderRequest(this.data)\n            .then((order: { orderData: string; pspReference: string }) => {\n                const stateOrder = { order: { orderData: order.orderData, pspReference: order.pspReference } };\n                this.setState(stateOrder);\n                return Promise.resolve();\n            })\n            .catch(error => {\n                if (error instanceof AdyenCheckoutError) {\n                    this.handleError(error);\n                } else {\n                    this.handleError(new AdyenCheckoutError('ERROR', error));\n                }\n            });\n    };\n\n    public submit() {\n        if (!this.isValid) {\n            this.showValidation();\n            return false;\n        }\n\n        this.createOrder()\n            .then(this.makePaymentsCall)\n            .then(sanitizeResponse)\n            .then(verifyPaymentDidNotFail)\n            .then(this.handleResponse)\n            .catch(this.handleFailedResult);\n    }\n\n    // Reimplement payButton similar to GiftCard to allow to set onClick\n    public payButton = props => {\n        return <PayButton {...props} />;\n    };\n\n    get isValid(): boolean {\n        return !!this.state.isValid;\n    }\n\n    get displayName(): string {\n        return this.props.name;\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        if (this.props.paymentData) {\n            return (\n                <SRPanelProvider srPanel={this.props.modules.srPanel}>\n                    <Await\n                        clientKey={this.props.clientKey}\n                        paymentData={this.props.paymentData}\n                        onError={this.props.onError}\n                        onComplete={this.onComplete}\n                        brandLogo={this.icon}\n                        type={this.constructor['type']}\n                        messageText={this.props.i18n.get('ancv.confirmPayment')}\n                        awaitText={this.props.i18n.get('await.waitForConfirmation')}\n                        showCountdownTimer={config.showCountdownTimer}\n                        throttleTime={config.THROTTLE_TIME}\n                        throttleInterval={config.THROTTLE_INTERVAL}\n                        onActionHandled={this.onActionHandled}\n                    />\n                </SRPanelProvider>\n            );\n        }\n\n        return (\n            <ANCVInput\n                ref={ref => {\n                    this.componentRef = ref;\n                }}\n                {...this.props}\n                onSubmit={this.submit}\n                onChange={this.setState}\n                payButton={this.payButton}\n                showPayButton={this.props.showPayButton}\n            />\n        );\n    }\n}\n\nexport default ANCVElement;\n"],"names":["ANCVElement","UIElement","formatData","_this_state_data","paymentMethod","type","beneficiaryId","this","state","data","submit","isValid","showValidation","createOrder","then","makePaymentsCall","sanitizeResponse","verifyPaymentDidNotFail","handleResponse","catch","handleFailedResult","displayName","props","name","componentToRender","paymentData","h","SRPanelProvider","srPanel","modules","Await","clientKey","onError","onComplete","brandLogo","icon","constructor","messageText","i18n","get","awaitText","showCountdownTimer","config","throttleTime","THROTTLE_TIME","throttleInterval","THROTTLE_INTERVAL","onActionHandled","ANCVInput","ref","componentRef","onSubmit","onChange","setState","payButton","showPayButton","super","args","_define_property","onOrderRequest","Promise","resolve","reject","session","setStatus","order","stateOrder","orderData","pspReference","error","AdyenCheckoutError","handleError","PayButton"],"mappings":"i/BAWO,MAAMA,UAAoBC,EAM7BC,UAAAA,GAI2B,IAAAC,EAHvB,MAAO,CACHC,cAAe,CACXC,KAAML,EAAYK,KAClBC,cAA8B,QAAfH,EAAAI,KAAKC,MAAMC,YAAX,IAAAN,OAAA,EAAAA,EAAiBG,eAG5C,CAwCOI,MAAAA,GACH,IAAKH,KAAKI,QAEN,OADAJ,KAAKK,kBACE,EAGXL,KAAKM,cACAC,KAAKP,KAAKQ,kBACVD,KAAKE,GACLF,KAAKG,GACLH,KAAKP,KAAKW,gBACVC,MAAMZ,KAAKa,mBACpB,CAOA,WAAIT,GACA,QAASJ,KAAKC,MAAMG,OACxB,CAEA,eAAIU,GACA,OAAOd,KAAKe,MAAMC,IACtB,CAEmBC,iBAAAA,GACf,OAAIjB,KAAKe,MAAMG,YAEPC,EAACC,EAAAA,CAAgBC,QAASrB,KAAKe,MAAMO,QAAQD,SACzCF,EAACI,EAAAA,CACGC,UAAWxB,KAAKe,MAAMS,UACtBN,YAAalB,KAAKe,MAAMG,YACxBO,QAASzB,KAAKe,MAAMU,QACpBC,WAAY1B,KAAK0B,WACjBC,UAAW3B,KAAK4B,KAChB9B,KAAME,KAAK6B,YAAY,KACvBC,YAAa9B,KAAKe,MAAMgB,KAAKC,IAAI,uBACjCC,UAAWjC,KAAKe,MAAMgB,KAAKC,IAAI,6BAC/BE,mBAAoBC,EAAOD,mBAC3BE,aAAcD,EAAOE,cACrBC,iBAAkBH,EAAOI,kBACzBC,gBAAiBxC,KAAKwC,mBAOlCrB,EAACsB,EAAAA,oUAAAA,CAAAA,CACGC,IAAKA,IACD1C,KAAK2C,aAAeD,IAEpB1C,KAAKe,OAAK,CACd6B,SAAU5C,KAAKG,OACf0C,SAAU7C,KAAK8C,SACfC,UAAW/C,KAAK+C,UAChBC,cAAehD,KAAKe,MAAMiC,gBAGtC,mBAlHGC,SAAAC,GAeHC,EAAAnD,KAAQoD,iBAAiBlD,GACjBF,KAAKe,MAAMqC,eACJ,IAAIC,QAAQ,CAACC,EAASC,KACzBvD,KAAKe,MAAMqC,eAAeE,EAASC,EAAQrD,KAG/CF,KAAKe,MAAMyC,QACJxD,KAAKe,MAAMyC,QAAQlD,mBAD9B,GASJ6C,OAAO7C,cAAc,KACjBN,KAAKyD,UAAU,WAGXzD,KAAKe,MAAM2C,MACJL,QAAQC,UAGZtD,KAAKoD,eAAepD,KAAKE,MAC3BK,KAAMmD,IACH,MAAMC,EAAa,CAAED,MAAO,CAAEE,UAAWF,EAAME,UAAWC,aAAcH,EAAMG,eAE9E,OADA7D,KAAK8C,SAASa,GACPN,QAAQC,YAElB1C,MAAMkD,IACCA,aAAiBC,EACjB/D,KAAKgE,YAAYF,GAEjB9D,KAAKgE,YAAY,IAAID,EAAmB,QAASD,QAoBjEX,EAAAnD,KAAO+C,YAAYhC,GACRI,EAAC8C,EAAclD,KApE1BoC,EADS1D,EACKK,OAAO"}