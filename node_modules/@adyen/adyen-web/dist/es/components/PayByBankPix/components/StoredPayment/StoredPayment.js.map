{"version":3,"file":"StoredPayment.js","sources":["../../../../../../src/components/PayByBankPix/components/StoredPayment/StoredPayment.tsx"],"sourcesContent":["import { h } from 'preact';\nimport { useState, useEffect, useRef, useCallback } from 'preact/hooks';\nimport { useCoreContext } from '../../../../core/Context/CoreProvider';\nimport { PaymentProps } from './types';\nimport useImage from '../../../../core/Context/useImage';\nimport PayButton from '../../../internal/PayButton';\nimport './StoredPayment.scss';\nimport getAuthorizationStatus from './getAuthorizationStatus';\nimport PayByBankPixAwait from '../Enrollment/components/PayByBankPixAwait';\n\nfunction StoredPayment({\n    onPay,\n    type,\n    countdownTime,\n    amount,\n    txVariant,\n    setComponentRef,\n    enrollmentId,\n    initiationId,\n    clientKey,\n    onAuthorize,\n    onError\n}: PaymentProps) {\n    const { i18n, loadingContext } = useCoreContext();\n    const getImage = useImage();\n    const [status, setStatus] = useState('ready');\n    const [authorizationOptions, setAuthorizationOptions] = useState<string>(null);\n    const buttonModifiers = ['standalone'];\n    const logos = [\n        {\n            name: 'open-finance',\n            alt: i18n.get('paybybankpix.await.logoAlt.openFinance'),\n            src: `${getImage({ parentFolder: `${txVariant}/` })('open-finance')}`\n        }\n    ];\n\n    const self = useRef({\n        setStatus\n    });\n\n    const pollStatus = useCallback(async () => {\n        if (authorizationOptions) return;\n\n        const response = await getAuthorizationStatus({ enrollmentId, initiationId, clientKey, loadingContext });\n        if (response.authorizationOptions) {\n            setAuthorizationOptions(response.authorizationOptions);\n        }\n\n        return response;\n    }, [authorizationOptions, enrollmentId, initiationId, clientKey, loadingContext]);\n\n    useEffect(() => {\n        setComponentRef(self.current);\n    }, [setComponentRef]);\n\n    useEffect(() => {\n        if (authorizationOptions) {\n            onAuthorize(authorizationOptions);\n        }\n    }, [authorizationOptions]);\n\n    return type === 'await' ? (\n        <PayByBankPixAwait\n            logos={logos}\n            type={txVariant}\n            countdownTime={countdownTime}\n            clientKey={clientKey}\n            onError={onError}\n            awaitText={i18n.get('paybybankpix.await.fetchDetails')}\n            pollStatus={pollStatus}\n        ></PayByBankPixAwait>\n    ) : (\n        <PayButton\n            classNameModifiers={buttonModifiers}\n            label={i18n.get('paybybankpix.redirectBtn.label')}\n            status={status}\n            amount={amount}\n            onClick={onPay}\n        />\n    );\n}\n\nexport default StoredPayment;\n"],"names":["StoredPayment","onPay","type","countdownTime","amount","txVariant","setComponentRef","enrollmentId","initiationId","clientKey","onAuthorize","onError","i18n","loadingContext","useCoreContext","getImage","useImage","status","setStatus","useState","authorizationOptions","setAuthorizationOptions","logos","name","alt","get","src","parentFolder","self","useRef","pollStatus","useCallback","async","response","getAuthorizationStatus","useEffect","current","h","PayByBankPixAwait","awaitText","PayButton","classNameModifiers","label","onClick"],"mappings":"geAUA,SAASA,GAAcC,MACnBA,EAAKC,KACLA,EAAIC,cACJA,EAAaC,OACbA,EAAMC,UACNA,EAASC,gBACTA,EAAeC,aACfA,EAAYC,aACZA,EAAYC,UACZA,EAASC,YACTA,EAAWC,QACXA,IAEA,MAAMC,KAAEA,EAAIC,eAAEA,GAAmBC,IAC3BC,EAAWC,KACVC,EAAQC,GAAaC,EAAS,UAC9BC,EAAsBC,GAA2BF,EAAiB,MAEnEG,EAAQ,CACV,CACIC,KAAM,eACNC,IAAKZ,EAAKa,IAAI,0CACdC,IAAK,GAAGX,EAAS,CAAEY,aAAc,GAAGtB,MAA5BU,CAA4C,oBAItDa,EAAOC,EAAO,CAChBX,cAGEY,EAAaC,EAAYC,UAC3B,GAAIZ,EAAsB,OAE1B,MAAMa,QAAiBC,EAAuB,CAAE3B,eAAcC,eAAcC,YAAWI,mBAKvF,OAJIoB,EAASb,sBACTC,EAAwBY,EAASb,sBAG9Ba,GACR,CAACb,EAAsBb,EAAcC,EAAcC,EAAWI,IAYjE,OAVAsB,EAAU,KACN7B,EAAgBsB,EAAKQ,UACtB,CAAC9B,IAEJ6B,EAAU,KACFf,GACAV,EAAYU,IAEjB,CAACA,IAEY,UAATlB,EACHmC,EAACC,EAAAA,CACGhB,MAAOA,EACPpB,KAAMG,EACNF,cAAeA,EACfM,UAAWA,EACXE,QAASA,EACT4B,UAAW3B,EAAKa,IAAI,mCACpBK,WAAYA,IAGhBO,EAACG,EAAAA,CACGC,mBA9CgB,CAAC,cA+CjBC,MAAO9B,EAAKa,IAAI,kCAChBR,OAAQA,EACRb,OAAQA,EACRuC,QAAS1C,GAGrB"}