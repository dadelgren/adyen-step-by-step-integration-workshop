import{createElement as t,Fragment as e}from"../../../../../external/preact/dist/preact.js";import{useState as r,useEffect as o,useCallback as s}from"../../../../../external/preact/hooks/dist/hooks.js";import n from"../../context/useClickToPayContext.js";import a from"./CtPSingleCard/CtPSingleCard.js";import i from"../../../PayButton/PayButton.js";import{amountLabel as c}from"../../../PayButton/utils.js";import m from"./CtPCardsList/CtPCardsList.js";import l from"../../services/sdks/SrciError.js";import u from"../CtPSection/CtPSection.js";import{CTP_IFRAME_NAME as d}from"../../services/utils.js";import p from"../../../IFrame/Iframe.js";import f from"../../../../../core/Context/useImage.js";import{useCoreContext as C}from"../../../../../core/Context/CoreProvider.js";import g from"../../../../../utils/isMobile.js";import h from"../../../../../core/Errors/AdyenCheckoutError.js";import{PREFIX as y}from"../../../Icon/constants.js";function k(t,e){if(!t)return null;const r=e.get(`ctp.errors.${t}`);return r.includes("ctp.errors")?e.get("ctp.errors.UNKNOWN_ERROR"):r}function P(t,e,r){return r?g()?null:t.get("payButton.with",{values:{value:c(t,e),maskedData:`•••• ${r?.panLastFour}`}}):t.get("payButton")}const j=({onDisplayCardComponent:c})=>{const{i18n:g}=C(),j=f(),{amount:E,cards:S,checkout:x,isCtpPrimaryPaymentMethod:v,status:b,onSubmit:R,onSetStatus:$,onError:w}=n(),[B,M]=r(S.find(t=>!t.isExpired)||S[0]),[N,D]=r(null),F=S.every(t=>t.isExpired),[I,_]=r(!1);o(()=>{(0===S.length||F)&&c?.()},[c,F,S]);const L=s(async()=>{if(B)try{_(!0),D(null),$("loading");const t=await x(B);R(t)}catch(t){t instanceof l&&(D(t?.reason),console.warn(`CtP - Checkout: Reason: ${t?.reason} / Source: ${t?.source} / Scheme: ${t?.scheme}`)),_(!1),w(t instanceof h?t:new h("ERROR","Error during ClickToPay checkout",{cause:t}))}},[x,B]),O=s(t=>{M(t)},[]),T=I&&"loading"===b&&B?.isDcfPopupEmbedded,K="loading"!==b||!T,A=s(t=>{"Enter"===t.key&&L()},[L]);return t(e,null,t(p,{name:d,height:"380",width:"100%",classNameModifiers:[T?"":"hidden"]}),K&&t(e,null,t(u.Title,null,g.get("ctp.cards.title")),0===S.length&&t("div",{className:"adyen-checkout-ctp__empty-cards"},g.get("ctp.emptyProfile.message")),1===S.length&&t(a,{card:S[0],errorMessage:k(N,g)}),S.length>1&&t(m,{cardSelected:B,cards:S,onChangeCard:O,errorMessage:k(N,g)}),t(i,{disabled:F,amount:E,label:P(g,E,B),status:b,variant:v?"primary":"secondary",icon:0!==S.length&&j({imageFolder:"components/"})(v?`${y}lock`:`${y}lock_black`),onClick:L,onKeyDown:A})))};export{j as default};
//# sourceMappingURL=CtPCards.js.map
