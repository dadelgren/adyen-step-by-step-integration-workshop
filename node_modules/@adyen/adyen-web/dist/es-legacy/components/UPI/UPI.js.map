{"version":3,"file":"UPI.js","sources":["../../../../src/components/UPI/UPI.tsx"],"sourcesContent":["import { h, RefObject } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport UPIComponent from './components/UPIComponent';\nimport { Await } from '../internal/Await';\nimport { QRLoader } from '../internal/QRLoader';\nimport { UPIConfiguration, UpiMode, UpiPaymentData, UpiType } from './types';\nimport SRPanelProvider from '../../core/Errors/SRPanelProvider';\nimport { TxVariants } from '../tx-variants';\nimport isMobile from '../../utils/isMobile';\nimport type { ICore } from '../../core/types';\nimport { getIntentOption, getQrOption, getVpaOption } from './constants';\n\n/**\n * For mobile:\n * We should show upi_collect and upi_intent depending on if `apps` are returned in /paymentMethods response.\n * If there is no apps, hide segmented controls.\n * The upi_collect should always be on the second tab.\n * Never show QR code.\n *\n * For non-mobile:\n * We should never show the upi_intent (ignore `apps` in /paymentMethods response)\n * The upi_qr should be on the first tab and the upi_collect should be on second tab\n */\n\nclass UPI extends UIElement<UPIConfiguration> {\n    public static type = TxVariants.upi;\n    public static txVariants = [TxVariants.upi, TxVariants.upi_qr, TxVariants.upi_collect, TxVariants.upi_intent];\n\n    private selectedMode: UpiMode;\n\n    constructor(checkout: ICore, props: UPIConfiguration) {\n        super(checkout, props);\n        this.selectedMode = this.props.defaultMode;\n    }\n\n    formatProps(props: UPIConfiguration): UPIConfiguration {\n        if (!isMobile()) {\n            return {\n                ...super.formatProps(props),\n                defaultMode: ['qrCode', 'vpa'].includes(props?.defaultMode) ? props.defaultMode : 'qrCode',\n                apps: [], // For desktop, ignore the apps\n                segmentedControlOptions: [getQrOption(props.i18n), getVpaOption(props.i18n)]\n            };\n        }\n\n        const { i18n, apps = [] } = props;\n        const hasIntentApps = apps.length > 0;\n        if (hasIntentApps) {\n            // Mobile with UPI apps\n            const allowedModes: UpiMode[] = ['intent', 'vpa'];\n            const defaultMode = allowedModes.includes(props.defaultMode) ? props.defaultMode : 'intent';\n            return {\n                ...super.formatProps(props),\n                defaultMode,\n                apps,\n                segmentedControlOptions: [getIntentOption(i18n), getVpaOption(i18n)]\n            };\n        }\n\n        // Mobile, but no UPI apps\n        return {\n            ...super.formatProps(props),\n            defaultMode: 'vpa', // Only VPA is possible\n            apps: [],\n            segmentedControlOptions: []\n        };\n    }\n\n    public get isValid(): boolean {\n        return this.state.isValid;\n    }\n\n    public formatData(): UpiPaymentData {\n        const { virtualPaymentAddress, app } = this.state.data || {};\n\n        return {\n            paymentMethod: {\n                type: this.paymentType,\n                ...(this.paymentType === TxVariants.upi_collect && virtualPaymentAddress && { virtualPaymentAddress }),\n                ...(this.paymentType === TxVariants.upi_intent && app?.id && { appId: app.id })\n            }\n        };\n    }\n\n    get paymentType(): UpiType {\n        if (this.selectedMode === 'qrCode') {\n            return TxVariants.upi_qr;\n        }\n        if (this.selectedMode === 'vpa') {\n            return TxVariants.upi_collect;\n        }\n        return TxVariants.upi_intent;\n    }\n\n    private onUpdateMode = (mode: UpiMode): void => {\n        this.selectedMode = mode;\n    };\n\n    private renderContent(type: string, url: string, paymentMethodType: string): h.JSX.Element {\n        const isAutoPay = !!this.props.mandate;\n\n        switch (type) {\n            case 'qrCode':\n                return (\n                    <QRLoader\n                        {...this.props}\n                        qrCodeData={this.props.qrCodeData ? encodeURIComponent(this.props.qrCodeData) : null}\n                        type={TxVariants.upi_qr}\n                        brandLogo={this.props.brandLogo || this.icon}\n                        onComplete={this.onComplete}\n                        introduction={this.props.i18n.get('upi.qrCodeWaitingMessage')}\n                        countdownTime={this.props.countdownTime ?? 5}\n                        onActionHandled={this.onActionHandled}\n                        showAmount={!isAutoPay}\n                    />\n                );\n            case 'await':\n                return (\n                    <Await\n                        url={url}\n                        type={paymentMethodType}\n                        showCountdownTimer\n                        shouldRedirectAutomatically\n                        showAmount={!isAutoPay}\n                        countdownTime={this.props.countdownTime ?? 5}\n                        clientKey={this.props.clientKey}\n                        paymentData={this.props.paymentData}\n                        onActionHandled={this.onActionHandled}\n                        onError={this.props.onError}\n                        messageText={this.props.i18n.get('upi.vpaWaitingMessage')}\n                        awaitText={this.props.i18n.get('await.waitForConfirmation')}\n                        onComplete={this.onComplete}\n                        brandLogo={this.icon}\n                        amount={this.props.amount}\n                    />\n                );\n            default:\n                return (\n                    <UPIComponent\n                        ref={(ref: RefObject<typeof UPIComponent>) => {\n                            this.componentRef = ref;\n                        }}\n                        payButton={this.payButton}\n                        onChange={this.setState}\n                        onUpdateMode={this.onUpdateMode}\n                        apps={this.props.apps}\n                        segmentedControlOptions={this.props.segmentedControlOptions}\n                        defaultMode={this.props.defaultMode}\n                        showPayButton={this.props.showPayButton}\n                        amount={this.props.amount}\n                        mandate={this.props.mandate}\n                    />\n                );\n        }\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        const { type, url, paymentMethodType } = this.props;\n        return <SRPanelProvider srPanel={this.props.modules.srPanel}>{this.renderContent(type, url, paymentMethodType)}</SRPanelProvider>;\n    }\n}\n\nexport default UPI;\n"],"names":["UPI","UIElement","formatProps","props","isMobile","_object_spread_props","_object_spread","super","defaultMode","includes","apps","segmentedControlOptions","getQrOption","i18n","getVpaOption","length","getIntentOption","isValid","this","state","formatData","virtualPaymentAddress","app","data","paymentMethod","type","paymentType","TxVariants","upi_collect","upi_intent","id","appId","selectedMode","upi_qr","renderContent","url","paymentMethodType","isAutoPay","mandate","_this_props_countdownTime","h","QRLoader","qrCodeData","encodeURIComponent","brandLogo","icon","onComplete","introduction","get","countdownTime","onActionHandled","showAmount","_this_props_countdownTime1","Await","showCountdownTimer","shouldRedirectAutomatically","clientKey","paymentData","onError","messageText","awaitText","amount","UPIComponent","ref","componentRef","payButton","onChange","setState","onUpdateMode","showPayButton","componentToRender","SRPanelProvider","srPanel","modules","constructor","checkout","_define_property","mode","upi","txVariants"],"mappings":"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"}