import{useState as e,useRef as t,useEffect as o}from"../../external/preact/hooks/dist/hooks.js";import r from"../../core/Services/payment-status.js";import{processPaymentStatusResponse as a}from"../../core/ProcessResponse/PaymentStatus/PaymentStatus.js";import n from"../../core/Errors/AdyenCheckoutError.js";import{DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_TIME_MS as s,DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_INTERVAL_MS as l,DEFAULT_PAYMENT_STATUS_TIMER_DELAY_MS as p}from"./constants.js";function c(c){const[i,u]=e(!1),[d,m]=e(!1),[y,f]=e(!0);var h;const[v,R]=e(null!==(h=c.delay)&&void 0!==h?h:p),[E,w]=e(100),[k,T]=e(0),[D,g]=e(!1),j=t(null),x=async()=>{const{paymentData:e,clientKey:t,throttleInterval:o,pollStatus:s}=c,l=null!=s?s:()=>r(e,t,c.loadingContext,o);var p;D||(null===(p=c.onActionHandled)||void 0===p||p.call(c,{componentType:c.type,actionDescription:"polling-started"}),g(!0));return l().then(a).catch(e=>({type:"network-error",props:e})).then(e=>{switch(e.type){case"success":(e=>{if(u(!0),f(!1),e.props.payload){const t={data:{details:{payload:e.props.payload},paymentData:c.paymentData}};c.onComplete(t)}else m(!0),c.onError(new n("ERROR","successful result, but no payload in response"))})(e);break;case"error":(e=>{if(m(!0),f(!1),e.props.payload){const t={data:{details:{payload:e.props.payload},paymentData:c.paymentData}};c.onComplete(t)}else{const e=new n("ERROR","error result with no payload in response");c.onError(e)}})(e);break;default:f(!1)}})};o(()=>{x()},[]),o(()=>{if(d||i||y)return;return j.current=setTimeout(()=>{(async()=>{const e=performance.now();await x();const t=performance.now(),o=Math.round(t-e),r=k+o+v;var a,n,p;T(r),r>=(null!==(a=c.throttleTime)&&void 0!==a?a:s)&&v!==(null!==(n=c.throttleInterval)&&void 0!==n?n:l)&&R(null!==(p=c.throttleInterval)&&void 0!==p?p:l)})()},v),()=>{clearTimeout(j.current)}},[d,i,y,v,c.throttleTime,c.throttleInterval,k]);return{state:{completed:i,expired:d,loading:y,percentage:E,timePassed:k},actions:{onTick:e=>{w(e.percentage)},onTimeUp:()=>{m(!0),c.onError(new n("ERROR","Payment Expired"))}}}}export{c as usePaymentStatusTimer};
//# sourceMappingURL=usePaymentStatusTimer.js.map
