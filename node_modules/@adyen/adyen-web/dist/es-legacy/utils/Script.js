import t from"../core/Errors/AdyenCheckoutError.js";import{AnalyticsInfoEvent as i,InfoEventType as s}from"../core/Analytics/events/AnalyticsInfoEvent.js";function e(t,i,s){return i in t?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t}class r{removeScript(){var t,i;null===(i=this.script)||void 0===i||null===(t=i.parentNode)||void 0===t||t.removeChild(this.script),this.script=null}loadScript(){return new Promise((i,s)=>{var e;const r=document.querySelector(this.node);if(!r)return void s(new t("SCRIPT_ERROR",`Unable to find script container node: ${this.node}`));const o=()=>{this.script&&(this.script.removeEventListener("load",n),this.script.removeEventListener("error",a))},n=()=>{this.script.setAttribute("data-script-loaded","true"),o(),i()},a=i=>{o(),s(new t("SCRIPT_ERROR",`Unable to load script ${this.src}.${(null==i?void 0:i.message)&&`Message: ${i.message}`}`,{cause:(null==i?void 0:i.error)||i}))};if(this.script=r.querySelector(`script[src="${this.src}"]`),null===(e=this.script)||void 0===e?void 0:e.getAttribute("data-script-loaded"))i();else{if(this.script)return this.script.addEventListener("load",n),void this.script.addEventListener("error",a);this.script=document.createElement("script"),Object.assign(this.script,this.attributes),Object.assign(this.script.dataset,this.dataAttributes),this.script.src=this.src,this.script.async=!0,this.script.addEventListener("load",n),this.script.addEventListener("error",a),r.appendChild(this.script)}})}trackEvent(t){var s;const e=new i({type:t,component:this.component,cdnUrl:this.baseUrl});null===(s=this.analytics)||void 0===s||s.sendAnalytics(e)}constructor({src:i,component:o,node:n="body",attributes:a,dataAttributes:c,analytics:d}){e(this,"src",void 0),e(this,"component",void 0),e(this,"node",void 0),e(this,"attributes",void 0),e(this,"dataAttributes",void 0),e(this,"analytics",void 0),e(this,"baseUrl",void 0),e(this,"script",void 0),e(this,"loadPromise",null),e(this,"rejectLoadPromise",null),e(this,"load",()=>(null!==this.loadPromise||(this.loadPromise=new Promise((t,i)=>{this.rejectLoadPromise=i;let e=0;this.trackEvent(s.sdkDownloadInitiated);const o=async()=>{try{e++,await this.loadScript(),this.trackEvent(s.sdkDownloadCompleted),t()}catch(t){if(null===this.loadPromise)return;this.trackEvent(s.sdkDownloadFailed),this.removeScript(),e<r.MAX_NUMBER_OF_RETRIES?setTimeout(()=>{o()},r.RETRY_DELAY):(this.trackEvent(s.sdkDownloadAborted),this.loadPromise=null,this.rejectLoadPromise=null,i(t))}};o()})),this.loadPromise)),e(this,"remove",()=>{var i;null===(i=this.rejectLoadPromise)||void 0===i||i.call(this,new t("CANCEL","Script loading cancelled.")),this.removeScript(),this.loadPromise=null}),this.src=i,this.component=o,this.node=n,this.attributes=a,this.dataAttributes=c,this.analytics=d,this.baseUrl=function(t){const i=new URL(t);return i.origin+i.pathname}(this.src)}}e(r,"RETRY_DELAY",1e3),e(r,"MAX_NUMBER_OF_RETRIES",3);export{r as default};
//# sourceMappingURL=Script.js.map
