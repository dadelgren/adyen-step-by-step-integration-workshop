{"version":3,"file":"PayTo.js","sources":["../../../../src/components/PayTo/PayTo.tsx"],"sourcesContent":["import { Fragment, h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport { Await } from '../../components/internal/Await';\nimport SRPanelProvider from '../../core/Errors/SRPanelProvider';\nimport { TxVariants } from '../tx-variants';\nimport { PayToIdentifierEnum } from './components/IdentifierSelector';\nimport PayToComponent from './components/PayToComponent';\nimport { PayToInstructions } from './components/PayToInstructions';\nimport MandateSummary from './components/MandateSummary';\nimport { PayToConfiguration, PayToData } from './types';\nimport PayButton, { payAmountLabel } from '../internal/PayButton';\n\n/*\nAwait Config (previously in its own file)\n */\nconst COUNTDOWN_MINUTES = 15; // min\nconst THROTTLE_TIME = 60000; // ms\nconst THROTTLE_INTERVAL = 10000; // ms\n\nconst config = {\n    COUNTDOWN_MINUTES,\n    THROTTLE_TIME,\n    THROTTLE_INTERVAL,\n    showCountdownTimer: false\n};\n\nconst getAccountIdentifier = (state: PayToData) => {\n    // if it's BSB Input type merge bankAccount with BSB\n    if (state.selectedInput === 'bsb-option') {\n        return `${state.bsb}-${state.bankAccountNumber}`;\n    } else if (state.selectedInput === 'payid-option') {\n        // otherwise use the option in the dropdown\n        switch (state.selectedIdentifier) {\n            case PayToIdentifierEnum.email:\n                return state.email;\n            case PayToIdentifierEnum.abn:\n                return state.abn;\n            case PayToIdentifierEnum.orgid:\n                return state.orgid;\n            case PayToIdentifierEnum.phone:\n                // merge the phone prefix and number - see comment in ticket\n                return `${state.phonePrefix}-${state.phoneNumber}`;\n        }\n    }\n};\n/**\n *\n */\nexport class PayToElement extends UIElement<PayToConfiguration> {\n    public static readonly type = TxVariants.payto;\n\n    protected static defaultProps = {\n        placeholders: {}\n    };\n\n    formatProps(props: PayToConfiguration) {\n        return {\n            ...props,\n            data: {\n                ...props.data,\n                phonePrefix: '+61' // hardcode +61\n            }\n        };\n    }\n\n    /**\n     * Formats the component data output\n     */\n    formatData() {\n        if (this.props.storedPaymentMethodId) {\n            return {\n                paymentMethod: {\n                    type: PayToElement.type,\n                    storedPaymentMethodId: this.props.storedPaymentMethodId\n                }\n            };\n        }\n\n        return {\n            paymentMethod: {\n                type: PayToElement.type,\n                shopperAccountIdentifier: getAccountIdentifier(this.state.data)\n            },\n            shopperName: {\n                firstName: this.state.data.firstName,\n                lastName: this.state.data.lastName\n            }\n        };\n    }\n\n    get isValid(): boolean {\n        if (this.props.storedPaymentMethodId) {\n            return true;\n        }\n\n        return !!this.state.isValid;\n    }\n\n    get displayName() {\n        if (this.props.storedPaymentMethodId && this.props.label) {\n            return this.props.label;\n        }\n        return this.props.name;\n    }\n\n    get additionalInfo() {\n        return this.props.storedPaymentMethodId ? this.props.name : '';\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        // Stored\n        if (this.props.storedPaymentMethodId) {\n            return (\n                <Fragment>\n                    {this.props.showPayButton && (\n                        <PayButton\n                            {...this.props}\n                            classNameModifiers={['standalone']}\n                            amount={this.props.amount}\n                            label={payAmountLabel(this.props.i18n, this.props.amount)}\n                            onClick={this.submit}\n                        />\n                    )}\n                </Fragment>\n            );\n        }\n        // Await\n        if (this.props.paymentData) {\n            return (\n                <SRPanelProvider srPanel={this.props.modules.srPanel}>\n                    <Await\n                        amount={this.props.amount}\n                        showAmount={true}\n                        instructions={PayToInstructions}\n                        clientKey={this.props.clientKey}\n                        paymentData={this.props.paymentData}\n                        onError={this.props.onError}\n                        onComplete={this.onComplete}\n                        brandLogo={this.icon}\n                        type={this.constructor['type']}\n                        messageText={this.props.i18n.get('payto.confirmPayment')}\n                        awaitText={this.props.i18n.get('payto.await.waitForConfirmation')}\n                        showCountdownTimer={config.showCountdownTimer}\n                        throttleTime={config.THROTTLE_TIME}\n                        throttleInterval={config.THROTTLE_INTERVAL}\n                        onActionHandled={this.onActionHandled}\n                        endSlot={() =>\n                            !!this.props.mandate && (\n                                <MandateSummary mandate={this.props.mandate} payee={this.props.payee} currencyCode={this.props.amount.currency} />\n                            )\n                        }\n                    />\n                </SRPanelProvider>\n            );\n        }\n        // Input\n        return (\n            <PayToComponent\n                data={this.props.data}\n                placeholders={this.props.placeholders}\n                setComponentRef={this.setComponentRef}\n                onChange={this.setState}\n                payButton={this.payButton}\n                showPayButton={this.props.showPayButton}\n            />\n        );\n    }\n}\n\nexport default PayToElement;\n"],"names":["config","getAccountIdentifier","state","selectedInput","bsb","bankAccountNumber","selectedIdentifier","PayToIdentifierEnum","email","abn","orgid","phone","phonePrefix","phoneNumber","PayToElement","UIElement","formatProps","props","_object_spread_props","_object_spread","data","formatData","this","storedPaymentMethodId","paymentMethod","type","shopperAccountIdentifier","shopperName","firstName","lastName","isValid","displayName","label","name","additionalInfo","componentToRender","h","Fragment","showPayButton","PayButton","classNameModifiers","amount","payAmountLabel","i18n","onClick","submit","paymentData","SRPanelProvider","srPanel","modules","Await","showAmount","instructions","PayToInstructions","clientKey","onError","onComplete","brandLogo","icon","constructor","messageText","get","awaitText","showCountdownTimer","throttleTime","throttleInterval","onActionHandled","endSlot","mandate","MandateSummary","payee","currencyCode","currency","PayToComponent","placeholders","setComponentRef","onChange","setState","payButton","_define_property","TxVariants","payto","defaultProps"],"mappings":"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"}