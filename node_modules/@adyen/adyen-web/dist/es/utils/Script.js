import t from"../core/Errors/AdyenCheckoutError.js";import{AnalyticsInfoEvent as s,InfoEventType as i}from"../core/Analytics/events/AnalyticsInfoEvent.js";function e(t,s,i){return s in t?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i,t}class r{removeScript(){this.script?.parentNode?.removeChild(this.script),this.script=null}loadScript(){return new Promise((s,i)=>{const e=document.querySelector(this.node);if(!e)return void i(new t("SCRIPT_ERROR",`Unable to find script container node: ${this.node}`));const r=()=>{this.script&&(this.script.removeEventListener("load",o),this.script.removeEventListener("error",n))},o=()=>{this.script.setAttribute("data-script-loaded","true"),r(),s()},n=s=>{r(),i(new t("SCRIPT_ERROR",`Unable to load script ${this.src}.${s?.message&&`Message: ${s.message}`}`,{cause:s?.error||s}))};if(this.script=e.querySelector(`script[src="${this.src}"]`),this.script?.getAttribute("data-script-loaded"))s();else{if(this.script)return this.script.addEventListener("load",o),void this.script.addEventListener("error",n);this.script=document.createElement("script"),Object.assign(this.script,this.attributes),Object.assign(this.script.dataset,this.dataAttributes),this.script.src=this.src,this.script.async=!0,this.script.addEventListener("load",o),this.script.addEventListener("error",n),e.appendChild(this.script)}})}trackEvent(t){const i=new s({type:t,component:this.component,cdnUrl:this.baseUrl});this.analytics?.sendAnalytics(i)}constructor({src:s,component:o,node:n="body",attributes:a,dataAttributes:c,analytics:d}){e(this,"src",void 0),e(this,"component",void 0),e(this,"node",void 0),e(this,"attributes",void 0),e(this,"dataAttributes",void 0),e(this,"analytics",void 0),e(this,"baseUrl",void 0),e(this,"script",void 0),e(this,"loadPromise",null),e(this,"rejectLoadPromise",null),e(this,"load",()=>(null!==this.loadPromise||(this.loadPromise=new Promise((t,s)=>{this.rejectLoadPromise=s;let e=0;this.trackEvent(i.sdkDownloadInitiated);const o=async()=>{try{e++,await this.loadScript(),this.trackEvent(i.sdkDownloadCompleted),t()}catch(t){if(null===this.loadPromise)return;this.trackEvent(i.sdkDownloadFailed),this.removeScript(),e<r.MAX_NUMBER_OF_RETRIES?setTimeout(()=>{o()},r.RETRY_DELAY):(this.trackEvent(i.sdkDownloadAborted),this.loadPromise=null,this.rejectLoadPromise=null,s(t))}};o()})),this.loadPromise)),e(this,"remove",()=>{this.rejectLoadPromise?.(new t("CANCEL","Script loading cancelled.")),this.removeScript(),this.loadPromise=null}),this.src=s,this.component=o,this.node=n,this.attributes=a,this.dataAttributes=c,this.analytics=d,this.baseUrl=function(t){const s=new URL(t);return s.origin+s.pathname}(this.src)}}e(r,"RETRY_DELAY",1e3),e(r,"MAX_NUMBER_OF_RETRIES",3);export{r as default};
//# sourceMappingURL=Script.js.map
