import{createElement as t}from"../../../../external/preact/dist/preact.js";import{useRef as e,useState as a,useCallback as n,useEffect as o}from"../../../../external/preact/hooks/dist/hooks.js";import r from"../../../../utils/Script.js";import{KLARNA_WIDGET_URL as i}from"../../constants.js";import l from"../../../../core/Analytics/useAnalytics.js";function s(t,e){if(null==t)return{};var a,n,o=function(t,e){if(null==t)return{};var a,n,o={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(o[a]=t[a]);return o}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(o[a]=t[a])}return o}function c(c){var{sdkData:m,paymentMethodType:d,widgetInitializationTime:y,payButton:p}=c,u=s(c,["sdkData","paymentMethodType","widgetInitializationTime","payButton"]);const f=e(null),[_,h]=a("ready"),{analytics:w}=l(),k=n(()=>{h("error"),u.onComplete({data:{paymentData:u.paymentData,details:{}}})},[u.paymentData,u.onComplete]),g=n(()=>{window.Klarna.Payments.init({client_token:m.client_token}),window.Klarna.Payments.load({container:f.current,payment_method_category:m.payment_method_category},function(t){!t.show_form||t.error?k():u.onLoaded()})},[m.client_token,m.payment_method_category]),v=n(()=>{h("loading");try{window.Klarna.Payments.authorize({payment_method_category:m.payment_method_category},function(t){!0===t.approved&&!0===t.show_form?(h("success"),u.onComplete({data:{paymentData:u.paymentData,details:{authorization_token:t.authorization_token}}})):t.approved||!0!==t.show_form?k():(h("ready"),u.onError(t))})}catch(t){k()}},[m.payment_method_category,u.onComplete,u.onError]),b=t=>{"Enter"!==t.key&&"Enter"!==t.code||(t.preventDefault(),v())};return o(()=>{var t,e;(null===(e=window.Klarna)||void 0===e||null===(t=e.Payments)||void 0===t?void 0:t.init)&&g()},[y]),o(()=>{window.klarnaAsyncCallback=function(){g()};const t=new r({src:i,component:"klarna",analytics:w});return t.load(),()=>{t.remove()}},[g,w]),"error"!==_&&"success"!==_?t("div",{className:"adyen-checkout__klarna-widget"},t("div",{ref:f}),p({status:_,disabled:"loading"===_,onClick:v,onKeyDown:b})):null}export{c as KlarnaWidget};
//# sourceMappingURL=KlarnaWidget.js.map
