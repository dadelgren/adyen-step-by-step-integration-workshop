import{createElement as t}from"../../../../external/preact/dist/preact.js";import{useRef as e,useState as a,useCallback as o,useEffect as n}from"../../../../external/preact/hooks/dist/hooks.js";import r from"../../../../utils/Script.js";import{KLARNA_WIDGET_URL as s}from"../../constants.js";import i from"../../../../core/Analytics/useAnalytics.js";function c({sdkData:c,paymentMethodType:m,widgetInitializationTime:l,payButton:d,...y}){const p=e(null),[u,_]=a("ready"),{analytics:f}=i(),h=o(()=>{_("error"),y.onComplete({data:{paymentData:y.paymentData,details:{}}})},[y.paymentData,y.onComplete]),w=o(()=>{window.Klarna.Payments.init({client_token:c.client_token}),window.Klarna.Payments.load({container:p.current,payment_method_category:c.payment_method_category},function(t){!t.show_form||t.error?h():y.onLoaded()})},[c.client_token,c.payment_method_category]),k=o(()=>{_("loading");try{window.Klarna.Payments.authorize({payment_method_category:c.payment_method_category},function(t){!0===t.approved&&!0===t.show_form?(_("success"),y.onComplete({data:{paymentData:y.paymentData,details:{authorization_token:t.authorization_token}}})):t.approved||!0!==t.show_form?h():(_("ready"),y.onError(t))})}catch(t){h()}},[c.payment_method_category,y.onComplete,y.onError]),g=t=>{"Enter"!==t.key&&"Enter"!==t.code||(t.preventDefault(),k())};return n(()=>{const t=window.Klarna?.Payments?.init;t&&w()},[l]),n(()=>{window.klarnaAsyncCallback=function(){w()};const t=new r({src:s,component:"klarna",analytics:f});return t.load(),()=>{t.remove()}},[w,f]),"error"!==u&&"success"!==u?t("div",{className:"adyen-checkout__klarna-widget"},t("div",{ref:p}),d({status:u,disabled:"loading"===u,onClick:k,onKeyDown:g})):null}export{c as KlarnaWidget};
//# sourceMappingURL=KlarnaWidget.js.map
